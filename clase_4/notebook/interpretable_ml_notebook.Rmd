---
title: "Interpretable Machine Learning"
author: "Germán Rosati"
output: html_notebook
---

## Objetivos    

- Mostrar la implementación de algunos métodos de interpretación para modelos de Machine Learning


## Interpretabilidad



## Carga de librerías y datos

```{r, message=FALSE}
library(caret)
library(tidyverse)
library(rpart)
```


## Cargamos los datos

```{r}
load('../data/EPH_2015_II.RData')

data$pp03i<-factor(data$pp03i, labels=c('1-SI', '2-No', '9-NS'))



data$intensi<-factor(data$intensi, labels=c('1-Sub_dem', '2-SO_no_dem', 
                                            '3-Ocup.pleno', '4-Sobreoc',
                                            '5-No trabajo', '9-NS'))

data$pp07a<-factor(data$pp07a, labels=c('0-NC',
                                        '1-Menos de un mes',
                                        '2-1 a 3 meses',
                                        '3-3 a 6 meses',
                                        '4-6 a 12 meses',
                                        '5-12 a 60 meses',
                                        '6-Más de 60 meses',
                                        '9-NS'))



data <- data %>%
        mutate(imp_inglab1=factor(imp_inglab1, labels=c('non_miss','miss')))

df_train <- data %>%
        select(-p21)

set.seed(1234)
tr_index <- createDataPartition(y=df_train$imp_inglab1,
                                p=0.8,
                                list=FALSE)

train <- df_train[tr_index,]
test <- df_train[-tr_index,]
```


## Partial Dependence Plots

Comencemos analizando el random forest original que habíamos entrenado la semana anterior:

```{r}
rf_orig_clasif <- readRDS('../../clase_3/models/rf_fit_orig.RDS')
rf_orig_regre <- 
```

Los gráficos de dependencia parcial permiten visualizar el efecto marginal de una o dos variables independientes sobre la variable predicha de un modelo de Machine Learning. Un plot de dependencia parcial puede mostrar si la relación entre $X$ e $y$ es lineal, monotónica, o algún patrón más complejo. Si aplicáramos un pdp a una regresión lineal, ¿cuál sería el patrón del gráfico?

Para un